<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片对比器</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #f5f5f5;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .header {
            margin-bottom: 5px;
            text-align: center;
        }
        
        .title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2c3e50;
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            font-size: 1rem;
            color: #7f8c8d;
            margin: 8px 0 0 0;
            font-weight: 400;
        }
        .compare-container {
            position: relative;
            width: 90%;
            height: 90vh;
            max-width: 90vw;
            max-height: 80vh;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 12px;
            overflow: hidden;
            background: #fff;
        }
        .img-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        .left-wrapper {
            clip-path: inset(0 50% 0 0);
            z-index: 1;
        }
        .right-wrapper {
            clip-path: inset(0 0 0 50%);
            z-index: 1;
        }
        .compare-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            user-select: none;
            pointer-events: none;
            position: absolute;
            top: 0;
            left: 0;
        }
        .divider {
            position: absolute;
            top: 0;
            left: 50%;
            width: 20px; /* 扩大触发区域到20px */
            height: 100%;
            background: transparent; /* 背景透明 */
            transform: translateX(-10px); /* 居中对齐 */
            z-index: 3;
            cursor: ew-resize;
        }
        
        .divider::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            width: 1px;
            height: 100%;
            background: #378bff;
            transform: translateX(-0.5px);
            border-radius: 0.5px;
            box-shadow: 0 0 8px rgba(33,150,243,0.2);
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.querySelector('.compare-container');
            const wrappers = container.querySelectorAll('.img-wrapper');
            const imgs = container.querySelectorAll('.compare-img');
            const divider = container.querySelector('.divider');
            const minScale = 0.2;
            const maxScale = 100;
            // 分割线可拖动
            let isDraggingDivider = false;
            let dividerPercent = 0.5; // 0~1

            function updateDivider(pos) {
                // 限制分割线在容器内
                dividerPercent = Math.max(0.05, Math.min(0.95, pos));
                const percentStr = (dividerPercent * 100) + '%';
                divider.style.left = percentStr;
                divider.style.transform = `translateX(-10px)`; /* 调整为新的居中方式 */
                // clip-path 动态调整
                wrappers[0].style.clipPath = `inset(0 ${100-dividerPercent*100}% 0 0)`;
                wrappers[1].style.clipPath = `inset(0 0 0 ${dividerPercent*100}%)`;
            }

            divider.addEventListener('mousedown', function(e) {
                isDraggingDivider = true;
                document.body.style.cursor = 'ew-resize';
            });
            document.addEventListener('mousemove', function(e) {
                if (isDraggingDivider) {
                    const rect = container.getBoundingClientRect();
                    let percent = (e.clientX - rect.left) / rect.width;
                    updateDivider(percent);
                }
            });
            document.addEventListener('mouseup', function() {
                if (isDraggingDivider) {
                    isDraggingDivider = false;
                    document.body.style.cursor = '';
                }
            });
            // 初始化分割线
            updateDivider(0.5);
            // 为每个图片分别维护状态
            const states = [
                { scale: 1, offsetX: 0, offsetY: 0 },
                { scale: 1, offsetX: 0, offsetY: 0 }
            ];
            let draggingIdx = null;
            let startX = 0, startY = 0;

            function updateTransform(idx) {
                const s = states[idx];
                imgs[idx].style.transform = `translate(${s.offsetX}px, ${s.offsetY}px) scale(${s.scale})`;
            }
            // wheel 缩放
            wrappers.forEach((wrapper, idx) => {
                wrapper.addEventListener('wheel', function(e) {
                    if (e.ctrlKey) return;
                    e.preventDefault();
                    const delta = e.deltaY || e.detail || e.wheelDelta;
                    // 降低缩放灵敏度，原本1.08，改为1.03
                    let scaleStep = 1.015;
                    let newScale;
                    if (delta < 0) {
                        newScale = states[idx].scale * scaleStep;
                    } else {
                        newScale = states[idx].scale / scaleStep;
                    }
                    newScale = Math.max(minScale, Math.min(maxScale, newScale));
                    
                    // 获取鼠标在容器中的位置
                    const rect = wrapper.getBoundingClientRect();
                    const mouseX = e.clientX - rect.left;
                    const mouseY = e.clientY - rect.top;
                    
                    // 计算缩放中心偏移
                    const scaleFactor = newScale / states[idx].scale;
                    
                    // 计算鼠标相对于图片当前位置的偏移
                    const imgCenterX = rect.width / 2 + states[idx].offsetX;
                    const imgCenterY = rect.height / 2 + states[idx].offsetY;
                    
                    // 计算鼠标相对于图片中心的距离
                    const relativeX = mouseX - imgCenterX;
                    const relativeY = mouseY - imgCenterY;
                    
                    // 计算新的偏移量，使鼠标位置保持不变
                    const newOffsetX = states[idx].offsetX - relativeX * (scaleFactor - 1);
                    const newOffsetY = states[idx].offsetY - relativeY * (scaleFactor - 1);
                    
                    // 同步两张图片的缩放和偏移
                    states[0].scale = newScale;
                    states[1].scale = newScale;
                    states[0].offsetX = newOffsetX;
                    states[1].offsetX = newOffsetX;
                    states[0].offsetY = newOffsetY;
                    states[1].offsetY = newOffsetY;
                    
                    updateTransform(0);
                    updateTransform(1);
                }, { passive: false });

                // 拖放图片替换
                wrapper.addEventListener('dragover', function(e) {
                    e.preventDefault();
                });
                wrapper.addEventListener('drop', function(e) {
                    e.preventDefault();
                    const files = e.dataTransfer.files;
                    if (files && files.length > 0) {
                        const file = files[0];
                        if (file.type.startsWith('image/')) {
                            const reader = new FileReader();
                            reader.onload = function(evt) {
                                imgs[idx].src = evt.target.result;
                                // 拖入新图片后重置并同步两张图片的状态
                                states[0].scale = 1;
                                states[0].offsetX = 0;
                                states[0].offsetY = 0;
                                states[1].scale = 1;
                                states[1].offsetX = 0;
                                states[1].offsetY = 0;
                                updateTransform(0);
                                updateTransform(1);
                            };
                            reader.readAsDataURL(file);
                        }
                    }
                });
            });
            // 拖动
            wrappers.forEach((wrapper, idx) => {
            wrapper.addEventListener('mousedown', function(e) {
                if (e.button !== 0) return;
                draggingIdx = idx;
                startX = e.clientX;
                startY = e.clientY;
                wrapper.style.cursor = 'grabbing';
            });
            });
            document.addEventListener('mousemove', function(e) {
            if (draggingIdx === null) return;
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;
            // 同步两张图片的移动
            states[0].offsetX += dx;
            states[0].offsetY += dy;
            states[1].offsetX += dx;
            states[1].offsetY += dy;
            startX = e.clientX;
            startY = e.clientY;
            updateTransform(0);
            updateTransform(1);
            });
            document.addEventListener('mouseup', function() {
                if (draggingIdx !== null) {
                    wrappers[draggingIdx].style.cursor = '';
                    draggingIdx = null;
                }
            });
            // 防止图片拖拽默认行为
            imgs.forEach(img => {
                img.addEventListener('dragstart', e => e.preventDefault());
            });
        });
    </script>
</head>
<body>
    <div class="header">
        <h1 class="title">图片对比器</h1>
        <p class="subtitle">拖拽分割线对比图片 • 滚轮缩放 • 拖拽移动 • 拖放图片以加载</p>
    </div>
    <div class="compare-container">
        <div class="img-wrapper left-wrapper">
            <img class="compare-img left" src="./1.png" alt="图片1">
        </div>
        <div class="img-wrapper right-wrapper">
            <img class="compare-img right" src="./2.png" alt="图片2">
        </div>
        <div class="divider"></div>
    </div>
</body>
</html>
